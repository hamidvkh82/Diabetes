<!DOCTYPE html>
<html lang="fa" dir="rtl" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ©º Diabetes AI Checker | Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ´Ø®ÛŒØµ Ø¯ÛŒØ§Ø¨Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* Color system with CSS variables â€” supports light/dark & RTL/LTR */
        :root {
            --pink: #ff6b9d;
            --red: #e74c3c;
            --light-pink: #ffd6e0;
            --dark-red: #c0392b;
            --white: #ffffff;
            --gray-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #ffb8c5;
            --input-bg: #fff9fa;
            --shadow: rgba(231, 76, 60, 0.15);
            --result-positive-bg: linear-gradient(135deg, #ffe6e6, #ffd6d6);
            --result-negative-bg: linear-gradient(135deg, #e6f7e6, #d6f5d6);
            --history-bg: #fff0f3;
        }

        /* Dark mode overrides */
        .dark-mode {
            --white: #1e1e2e;
            --gray-bg: #11111d;
            --card-bg: #1a1a2a;
            --text: #e6e6ff;
            --text-light: #a9a9cc;
            --border: #5d3a4a;
            --input-bg: #25253a;
            --shadow: rgba(0, 0, 0, 0.4);
            --result-positive-bg: linear-gradient(135deg, #3a1a1a, #3a1a2a);
            --result-negative-bg: linear-gradient(135deg, #1a3a1a, #1a3a2a);
            --history-bg: #2a1a2a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff5f7, #ffe6eb);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            transition: background 0.4s, color 0.3s;
        }

        .dark-mode body {
            background: linear-gradient(135deg, #0f0c15, #1a1425);
        }

        .container {
            max-width: 750px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            position: relative;
        }

        .lang-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--pink);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 6px 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dark-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #555;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .dark-mode .dark-toggle {
            background: #ffd166;
            color: #333;
        }

        h1 {
            font-size: 2rem;
            color: var(--red);
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.05rem;
        }

        .ribbon {
            display: inline-block;
            background: var(--pink);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 20px var(--shadow);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 576px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .lang-toggle, .dark-toggle {
                position: static;
                margin: 5px;
            }
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--red);
        }

        .hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 3px;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text);
            transition: all 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--pink);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.2);
            background-color: var(--white);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--red), var(--pink));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(231, 76, 60, 0.4);
            background: linear-gradient(135deg, var(--dark-red), #ff528f);
        }

        .result-box {
            padding: 20px;
            border-radius: 16px;
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
            animation: fadeIn 0.6s ease;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .result-positive {
            background: var(--result-positive-bg);
            border: 2px solid var(--red);
            color: var(--dark-red);
        }

        .dark-mode .result-positive {
            color: #ffb3b3;
        }

        .result-negative {
            background: var(--result-negative-bg);
            border: 2px solid #2ecc71;
            color: #27ae60;
        }

        .dark-mode .result-negative {
            color: #b3ffb3;
        }

        .rule-info {
            margin-top: 10px;
            font-size: 0.95rem;
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid var(--pink);
        }

        .history-section {
            margin-top: 30px;
        }

        .history-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--red);
            margin-bottom: 12px;
        }

        .history-list {
            list-style: none;
        }

        .history-item {
            padding: 10px;
            background: var(--history-bg);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            border-left: 3px solid var(--pink);
            color: var(--text);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 4px;
            color: var(--pink);
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.4;
            white-space: normal;
        }

        .dark-mode .tooltip .tooltiptext {
            background-color: #444;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* LTR override */
        .ltr {
            direction: ltr;
            text-align: left;
        }
        .ltr .form-grid { grid-template-columns: 1fr 1fr; }
        .ltr header, .ltr footer { text-align: center; }
        .ltr .lang-toggle { left: auto; right: 20px; }
        .ltr .dark-toggle { right: auto; left: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button id="langToggle" class="lang-toggle">ðŸ‡¬ðŸ‡§ EN</button>
            <button id="darkToggle" class="dark-toggle">
                <i class="fas fa-moon"></i>
            </button>
            <h1 id="title">ðŸ©º Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ´Ø®ÛŒØµ Ø¯ÛŒØ§Ø¨Øª</h1>
            <p id="subtitle" class="subtitle">Ø¨Ø± Ø§Ø³Ø§Ø³ 8 Ù‚Ø§Ù†ÙˆÙ† ØªØ´Ø®ÛŒØµÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬â€ŒØ´Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ</p>
            <div id="ribbon" class="ribbon"><i class="fas fa-exclamation-triangle"></i> Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± Ø¨Ø±Ø§ÛŒ ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ø§Ø³Øª â€” Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…Ø´Ø§ÙˆØ±Ù‡ Ù¾Ø²Ø´Ú©ÛŒ Ù†ÛŒØ³Øª.</div>
        </header>

        <div class="card">
            <div class="form-grid">
                <div class="form-group">
                    <label id="labelGlucose">Ø³Ø·Ø­ Ú¯Ù„ÙˆÚ©Ø² Ø®ÙˆÙ† (Glucose)
                        <span class="tooltip">?<span id="tipGlucose" class="tooltiptext">Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ø§Ø´ØªØ§: Ø·Ø¨ÛŒØ¹ÛŒ < 100ØŒ Ù¾ÛŒØ´â€ŒØ¯ÛŒØ§Ø¨Øª 100â€“125ØŒ Ø¯ÛŒØ§Ø¨Øª â‰¥ 126</span></span>
                    </label>
                    <input type="number" id="glucose" placeholder="Ù…Ø«Ø§Ù„: 120" min="0" step="0.1">
                    <div id="hintGlucose" class="hint"></div>
                </div>

                <div class="form-group">
                    <label id="labelBMI">Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ (BMI)
                        <span class="tooltip">?<span id="tipBMI" class="tooltiptext">ÙˆØ²Ù† (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…) Ã· Ù…Ø±Ø¨Ø¹ Ù‚Ø¯ (Ù…ØªØ±)</span></span>
                    </label>
                    <input type="number" id="bmi" placeholder="Ù…Ø«Ø§Ù„: 28.5" min="0" step="0.1">
                    <div id="hintBMI" class="hint"></div>
                </div>

                <div class="form-group">
                    <label id="labelAge">Ø³Ù† (Ø³Ø§Ù„)</label>
                    <input type="number" id="age" placeholder="Ù…Ø«Ø§Ù„: 35" min="1" max="120" step="1">
                    <div id="hintAge" class="hint">       </div>
                </div>

                <div class="form-group">
                    <label id="labelDPF">ØªØ§Ø¨Ø¹ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¯ÛŒØ§Ø¨Øª
                        <span class="tooltip">?<span id="tipDPF" class="tooltiptext">Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø±Ø«ÛŒ Ø¯ÛŒØ§Ø¨Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø¨Ù‚Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</span></span>
                    </label>
                    <input type="number" id="diabetesPedigree" placeholder="Ù…Ø«Ø§Ù„: 0.5" min="0" step="0.001">
                    <div id="hintDPF" class="hint">   </div>
                </div>
            </div>

            <button id="checkBtn" class="btn pulse">
                <i class="fas fa-stethoscope"></i> <span id="btnText">Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ§Ø¨Øª</span>
            </button>
        </div>

        <div id="result" class="card" style="display:none;"></div>

        <div class="history-section card">
            <h3 class="history-title"><i class="fas fa-history"></i> <span id="historyTitle">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø±Ø³ÛŒâ€ŒÙ‡Ø§</span></h3>
            <ul id="historyList" class="history-list">
                <li id="historyEmpty" class="history-item">Ù‡Ù†ÙˆØ² Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>
            </ul>
        </div>

        <footer>
            <p id="footerText">âœ… Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾Ø²Ø´Ú©ÛŒ â€” Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: Ù†ÙˆØ§Ù…Ø¨Ø± Û²Û°Û²Ûµ | <strong>Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ù„ÙˆÚ©Ø² Ùˆ Ø³Ø§Ø¨Ù‚Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</strong></p>
        </footer>
    </div>

    <!-- Load Vazirmatn font -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        // === TRANSLATIONS ===
        const translations = {
            fa: {
                title: "ðŸ©º Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ´Ø®ÛŒØµ Ø¯ÛŒØ§Ø¨Øª",
                subtitle: "Ø¨Ø± Ø§Ø³Ø§Ø³ 8 Ù‚Ø§Ù†ÙˆÙ† ØªØ´Ø®ÛŒØµÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬â€ŒØ´Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ",
                ribbon: "Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± Ø¨Ø±Ø§ÛŒ ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ø§Ø³Øª â€” Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…Ø´Ø§ÙˆØ±Ù‡ Ù¾Ø²Ø´Ú©ÛŒ Ù†ÛŒØ³Øª.",
                labelGlucose: "Ø³Ø·Ø­ Ú¯Ù„ÙˆÚ©Ø² Ø®ÙˆÙ† (Glucose)",
                tipGlucose: "Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ø§Ø´ØªØ§: Ø·Ø¨ÛŒØ¹ÛŒ < 100ØŒ Ù¾ÛŒØ´â€ŒØ¯ÛŒØ§Ø¨Øª 100â€“125ØŒ Ø¯ÛŒØ§Ø¨Øª â‰¥ 126",
                hintGlucose: "ÙˆØ§Ø­Ø¯: mg/dL â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù†Ø§Ø´ØªØ§ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯",
                labelBMI: "Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ (BMI)",
                tipBMI: "ÙˆØ²Ù† (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…) Ã· Ù…Ø±Ø¨Ø¹ Ù‚Ø¯ (Ù…ØªØ±)",
                hintBMI: "Ø·Ø¨ÛŒØ¹ÛŒ: <25ØŒ Ø§Ø¶Ø§ÙÙ‡ ÙˆØ²Ù†: 25â€“30ØŒ Ú†Ø§Ù‚ÛŒ: â‰¥30",
                labelAge: "Ø³Ù† (Ø³Ø§Ù„)",
                hintAge: "Ø§ÙØ±Ø§Ø¯ Ø¨Ø§Ù„Ø§ÛŒ 30 Ø³Ø§Ù„ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ù…Ø¹Ø±Ø¶ Ù‡Ø³ØªÙ†Ø¯",
                labelDPF: "ØªØ§Ø¨Ø¹ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¯ÛŒØ§Ø¨Øª",
                tipDPF: "Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø±Ø«ÛŒ Ø¯ÛŒØ§Ø¨Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø¨Ù‚Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",
                hintDPF: "Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ~0.4 â€” Ù‡Ø±Ú†Ù‡ Ø¨ÛŒØ´ØªØ±ØŒ Ø®Ø·Ø± Ø¨ÛŒØ´ØªØ±",
                btnText: "Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ§Ø¨Øª",
                historyTitle: "ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø±Ø³ÛŒâ€ŒÙ‡Ø§",
                historyEmpty: "Ù‡Ù†ÙˆØ² Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.",
                footerText: "âœ… Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾Ø²Ø´Ú©ÛŒ â€” Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: Ù†ÙˆØ§Ù…Ø¨Ø± Û²Û°Û²Ûµ | Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ù„ÙˆÚ©Ø² Ùˆ Ø³Ø§Ø¨Ù‚Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",
                placeholderGlucose: "Ù…Ø«Ø§Ù„: 120",
                placeholderBMI: "Ù…Ø«Ø§Ù„: 28.5",
                placeholderAge: "Ù…Ø«Ø§Ù„: 35",
                placeholderDPF: "Ù…Ø«Ø§Ù„: 0.5",
                resultPositive: "Ù‡Ø´Ø¯Ø§Ø±: Ø§Ø­ØªÙ…Ø§Ù„ Ø¯ÛŒØ§Ø¨Øª Ø¨Ø§Ù„Ø§ Ø§Ø³Øª!",
                resultNegative: "Ø®Ø·Ø± Ø¯ÛŒØ§Ø¨Øª Ù¾Ø§ÛŒÛŒÙ† Ø§Ø³Øª.",
                advicePositive: "ØªÙˆØµÛŒÙ‡ ÙÙˆØ±ÛŒ: Ø­Ø¶ÙˆØ± Ø¯Ø± Ù…Ø·Ø¨ Ù¾Ø²Ø´Ú© Ùˆ Ø§Ù†Ø¬Ø§Ù… Ø¢Ø²Ù…Ø§ÛŒØ´ Ù‚Ø·Ø¹ÛŒ (HbA1c ÛŒØ§ ØªØ³Øª ØªØ­Ù…Ù„ Ú¯Ù„ÙˆÚ©Ø²)",
                adviceNegative: "Ø¨Ù‡Ø¯Ø§Ø´Øª Ø®ÙˆØ¯ Ø±Ø§ Ø­ÙØ¸ Ú©Ù†ÛŒØ¯: ÙˆØ±Ø²Ø´ØŒ Ø±Ú˜ÛŒÙ… Ø³Ø§Ù„Ù…ØŒ Ùˆ Ú†Ú©Ø§Ù¾ Ø³Ø§Ù„Ø§Ù†Ù‡",
                ruleDefault0: "Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ú©Ù„Ø§Ø³ 0)",
                // Rules FA
                rule1_1: "Rule 1 (Ø¯Ø³ØªÙ‡ 1): Glucose âˆˆ (101,154] âˆ§ BMI > 43.3 âˆ§ Age > 29",
                rule2_1: "Rule 2 (Ø¯Ø³ØªÙ‡ 1): Glucose > 154",
                rule3_1: "Rule 3 (Ø¯Ø³ØªÙ‡ 1): Glucose > 101 âˆ§ BMI > 26.7 âˆ§ DPF > 0.464 âˆ§ Age > 29",
                rule1_0: "Rule 1 (Ø¯Ø³ØªÙ‡ 0): Glucose â‰¤ 154 âˆ§ BMI â‰¤ 26.7",
                rule2_0: "Rule 2 (Ø¯Ø³ØªÙ‡ 0): Glucose â‰¤ 101",
                rule3_0: "Rule 3 (Ø¯Ø³ØªÙ‡ 0): Glucose â‰¤ 154 âˆ§ Age â‰¤ 29",
                rule4_0: "Rule 4 (Ø¯Ø³ØªÙ‡ 0): DPF âˆˆ (0.287, 0.307]",
                rule5_0: "Rule 5 (Ø¯Ø³ØªÙ‡ 0): Glucose â‰¤ 154 âˆ§ BMI â‰¤ 43.3 âˆ§ DPF â‰¤ 0.464"
            },
            en: {
                title: "ðŸ©º Diabetes AI Checker",
                subtitle: "Based on 8 diagnostic rules extracted from medical data",
                ribbon: "This tool is for screening only â€” not a substitute for medical advice.",
                labelGlucose: "Blood Glucose Level",
                tipGlucose: "Fasting: Normal <100, Prediabetes 100â€“125, Diabetes â‰¥126",
                hintGlucose: "Unit: mg/dL â€” typically measured fasting",
                labelBMI: "Body Mass Index (BMI)",
                tipBMI: "Weight (kg) Ã· HeightÂ² (m)",
                hintBMI: "Normal: <25, Overweight: 25â€“30, Obese: â‰¥30",
                labelAge: "Age (years)",
                hintAge: "Risk increases significantly after age 30",
                labelDPF: "Diabetes Pedigree Function",
                tipDPF: "Genetic likelihood of diabetes based on family history",
                hintDPF: "Average: ~0.4 â€” higher = higher risk",
                btnText: "Check Diabetes Risk",
                historyTitle: "Recent History",
                historyEmpty: "No tests performed yet.",
                footerText: "âœ… Based on clinical rule set â€” Updated: Nov 2025 | High accuracy via Glucose & family history",
                placeholderGlucose: "e.g., 120",
                placeholderBMI: "e.g., 28.5",
                placeholderAge: "e.g., 35",
                placeholderDPF: "e.g., 0.5",
                resultPositive: "âš ï¸ Warning: High risk of diabetes!",
                resultNegative: "âœ… Low diabetes risk.",
                advicePositive: "âš ï¸ Urgent: Consult a physician and get a confirmatory test (HbA1c or OGTT)",
                adviceNegative: "âœ… Maintain health: exercise, balanced diet, and annual check-ups",
                ruleDefault0: "Default (Class 0)",
                // Rules EN
                rule1_1: "Rule 1 (Class 1): Glucose âˆˆ (101,154] âˆ§ BMI > 43.3 âˆ§ Age > 29",
                rule2_1: "Rule 2 (Class 1): Glucose > 154",
                rule3_1: "Rule 3 (Class 1): Glucose > 101 âˆ§ BMI > 26.7 âˆ§ DPF > 0.464 âˆ§ Age > 29",
                rule1_0: "Rule 1 (Class 0): Glucose â‰¤ 154 âˆ§ BMI â‰¤ 26.7",
                rule2_0: "Rule 2 (Class 0): Glucose â‰¤ 101",
                rule3_0: "Rule 3 (Class 0): Glucose â‰¤ 154 âˆ§ Age â‰¤ 29",
                rule4_0: "Rule 4 (Class 0): DPF âˆˆ (0.287, 0.307]",
                rule5_0: "Rule 5 (Class 0): Glucose â‰¤ 154 âˆ§ BMI â‰¤ 43.3 âˆ§ DPF â‰¤ 0.464"
            }
        };

        // === STATE ===
        let lang = localStorage.getItem('lang') || 'fa'; // 'fa' or 'en'
        let darkMode = localStorage.getItem('darkMode') === 'true';
        let history = JSON.parse(localStorage.getItem('diabetesHistory') || '[]');

        // DOM Elements
        const htmlTag = document.getElementById('htmlTag');
        const langToggle = document.getElementById('langToggle');
        const darkToggle = document.getElementById('darkToggle');
        const placeholders = {
            glucose: document.getElementById('glucose'),
            bmi: document.getElementById('bmi'),
            age: document.getElementById('age'),
            diabetesPedigree: document.getElementById('diabetesPedigree')
        };

        // === INIT ===
        function init() {
            // Set language
            setLanguage(lang);
            langToggle.textContent = lang === 'fa' ? 'ðŸ‡¬ðŸ‡§ EN' : 'ðŸ‡®ðŸ‡· FA';
            
            // Set dark mode
            if (darkMode) {
                document.body.classList.add('dark-mode');
                darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode');
                darkToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }

            // Load history
            updateHistoryUI();

            // Auto-focus
            placeholders.glucose.focus();
        }

        // === LANGUAGE ===
        function setLanguage(newLang) {
            lang = newLang;
            localStorage.setItem('lang', lang);
            
            const t = translations[lang];
            document.getElementById('title').textContent = t.title;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('ribbon').textContent = t.ribbon;
            document.getElementById('labelGlucose').firstChild.textContent = t.labelGlucose;
            document.getElementById('tipGlucose').textContent = t.tipGlucose;
            document.getElementById('hintGlucose').textContent = t.hintGlucose;
            document.getElementById('labelBMI').firstChild.textContent = t.labelBMI;
            document.getElementById('tipBMI').textContent = t.tipBMI;
            document.getElementById('hintBMI').textContent = t.hintBMI;
            document.getElementById('labelAge').textContent = t.labelAge;
            document.getElementById('hintAge').textContent = t.hintAge;
            document.getElementById('labelDPF').firstChild.textContent = t.labelDPF;
            document.getElementById('tipDPF').textContent = t.tipDPF;
            document.getElementById('hintDPF').textContent = t.hintDPF;
            document.getElementById('btnText').textContent = t.btnText;
            document.getElementById('historyTitle').textContent = t.historyTitle;
            document.getElementById('historyEmpty').textContent = t.historyEmpty;
            document.getElementById('footerText').textContent = t.footerText;

            // Update placeholders
            placeholders.glucose.placeholder = t.placeholderGlucose;
            placeholders.bmi.placeholder = t.placeholderBMI;
            placeholders.age.placeholder = t.placeholderAge;
            placeholders.diabetesPedigree.placeholder = t.placeholderDPF;

            // RTL/LTR
            if (lang === 'fa') {
                htmlTag.setAttribute('lang', 'fa');
                htmlTag.setAttribute('dir', 'rtl');
                htmlTag.classList.remove('ltr');
            } else {
                htmlTag.setAttribute('lang', 'en');
                htmlTag.setAttribute('dir', 'ltr');
                htmlTag.classList.add('ltr');
            }
        }

        // === DARK MODE ===
        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            if (darkMode) {
                document.body.classList.add('dark-mode');
                darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode');
                darkToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // === RULE ENGINE ===
        function checkDiabetes() {
            const glucose = parseFloat(placeholders.glucose.value);
            const bmi = parseFloat(placeholders.bmi.value);
            const age = parseInt(placeholders.age.value);
            const dpf = parseFloat(placeholders.diabetesPedigree.value);
            const inputs = { glucose, bmi, age, dpf };

            const missing = Object.entries(inputs).filter(([k, v]) => isNaN(v) || v === '').map(([k]) => k);
            if (missing.length > 0) {
                alert(translations[lang].placeholderGlucose.includes('Ù…Ø«Ø§Ù„') ? 
                      'Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± Ù¾Ø± Ú©Ù†ÛŒØ¯.' : 
                      'Please fill all fields with valid numbers.');
                return;
            }

            let result = 0;
            let matchedRuleKey = 'ruleDefault0';

            // Rules for 1 (Diabetic)
            if (glucose > 154) {
                result = 1;
                matchedRuleKey = 'rule2_1';
            } else if (glucose > 101 && glucose <= 154 && bmi > 43.3 && age > 29) {
                result = 1;
                matchedRuleKey = 'rule1_1';
            } else if (glucose > 101 && bmi > 26.7 && dpf > 0.464 && age > 29) {
                result = 1;
                matchedRuleKey = 'rule3_1';
            }

            // Rules for 0 (Non-Diabetic) â€” only if not class 1
            if (result === 0) {
                if (glucose <= 101) {
                    matchedRuleKey = 'rule2_0';
                } else if (glucose <= 154 && bmi <= 26.7) {
                    matchedRuleKey = 'rule1_0';
                } else if (glucose <= 154 && age <= 29) {
                    matchedRuleKey = 'rule3_0';
                } else if (dpf > 0.287 && dpf <= 0.307) {
                    matchedRuleKey = 'rule4_0';
                } else if (glucose <= 154 && bmi <= 43.3 && dpf <= 0.464) {
                    matchedRuleKey = 'rule5_0';
                }
            }

            const t = translations[lang];
            const now = new Date().toLocaleString(lang === 'fa' ? 'fa-IR' : 'en-US');

            const entry = {
                time: now,
                inputs: { glucose, bmi, age, dpf },
                result,
                ruleKey: matchedRuleKey
            };

            // Save
            history.unshift(entry);
            if (history.length > 5) history = history.slice(0, 5);
            localStorage.setItem('diabetesHistory', JSON.stringify(history));
            updateHistoryUI();

            // Show result
            const resultDiv = document.getElementById('result');
            const ruleText = t[matchedRuleKey] || matchedRuleKey;
            let msg = '';

            if (result === 1) {
                msg = `
                    <div class="result-box result-positive">
                        <i class="fas fa-exclamation-triangle"></i> ${t.resultPositive}
                        <div class="rule-info">âœ… Based on: <strong>${ruleText}</strong></div>
                    </div>
                    <p style="text-align:center; margin-top:15px; color:${darkMode ? '#ffb3b3' : '#c0392b'};">
                        <i class="fas fa-user-md"></i> ${t.advicePositive}
                    </p>
                `;
            } else {
                msg = `
                    <div class="result-box result-negative">
                        <i class="fas fa-check-circle"></i> ${t.resultNegative}
                        <div class="rule-info">âœ… Based on: <strong>${ruleText}</strong></div>
                    </div>
                    <p style="text-align:center; margin-top:15px; color:${darkMode ? '#b3ffb3' : '#27ae60'};">
                        <i class="fas fa-heart"></i> ${t.adviceNegative}
                    </p>
                `;
            }

            resultDiv.innerHTML = msg;
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // === HISTORY UI ===
        function updateHistoryUI() {
            const list = document.getElementById('historyList');
            const t = translations[lang];

            if (history.length === 0) {
                list.innerHTML = `<li class="history-item">${t.historyEmpty}</li>`;
                return;
            }

            list.innerHTML = history.map(item => {
                const status = item.result === 1 ? 
                    (lang === 'fa' ? 'ðŸ”´ Ø¯ÛŒØ§Ø¨Øª Ù…Ø­ØªÙ…Ù„' : 'ðŸ”´ Likely Diabetic') : 
                    (lang === 'fa' ? 'ðŸŸ¢ Ø¨Ø¯ÙˆÙ† Ø¯ÛŒØ§Ø¨Øª' : 'ðŸŸ¢ No Diabetes');
                const ruleText = translations[lang][item.ruleKey] || item.ruleKey;
                return `<li class="history-item">
                    <strong>${item.time}</strong><br>
                    ðŸ“Š Glu:${item.inputs.glucose}, BMI:${item.inputs.bmi}, Age:${item.inputs.age}, DPF:${item.inputs.dpf}<br>
                    ${status} â€” ${ruleText}
                </li>`;
            }).join('');
        }

        // === EVENT LISTENERS ===
        langToggle.addEventListener('click', () => {
            setLanguage(lang === 'fa' ? 'en' : 'fa');
        });

        darkToggle.addEventListener('click', toggleDarkMode);
        document.getElementById('checkBtn').addEventListener('click', checkDiabetes);

        // Initialize
        init();
    </script>
</body>
</html>